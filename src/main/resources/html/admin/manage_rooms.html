%[site;title=Raumverwaltung;content=!FOLLOWS]
<section id="rooms">
    <header>
        <h1>Raumverwaltung</h1>
    </header>
    <main>
        <section id="add-rooms">
            <h2>Räume hinzufügen</h2>
            <form id="add-rooms-form" method="post" action="/add-rooms">
                <label for="csv-input">CSV-Datei:</label>
                <textarea id="csv-input" name="csv" rows="10" cols="50" placeholder="Raumname,Mindestlevel"></textarea>
                <button type="submit">Räume hinzufügen</button>
            </form>
        </section>
        <section id="room-list">
            <h2>Raumliste</h2>
            <table id="roomTable">
                <thead>
                    <tr>
                        <th>Raumname</th>
                        <th>Mindestlevel</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamically populated room rows will go here -->
                </tbody>
            </table>
        </section>
    </main>
    <nav>
        <a href="/dashboard"><button>Zurück zum Admin-Dashboard</button></a>
    </nav>
</section>
<script>
    document.getElementById('add-rooms-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const csv = form['csv'].value;
        await postDataAndDownload('/add-rooms', csv, 'räume.json');
    });
    document.addEventListener('DOMContentLoaded', async () => {
        populateTable("roomTable", "/rooms", (newRow, room) => {
            newRow.innerHTML = `<td>${room.label}</td><td>${room.minimumLevel}</td>`;
        });
    });
</script>